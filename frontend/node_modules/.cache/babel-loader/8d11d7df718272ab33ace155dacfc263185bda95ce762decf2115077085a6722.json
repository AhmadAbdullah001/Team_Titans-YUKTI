{"ast":null,"code":"import _objectSpread from\"C:/Users/ahmad/OneDrive/Desktop/evault/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useEffect,useState}from'react';import{ensureContractCode,ensureCorrectNetwork,ensureWalletConnected,getBrowserProvider,getReadOnlyContract}from'../contract/eth.js';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";function FilesPage(){const[files,setFiles]=useState([]);const[loading,setLoading]=useState(true);const[error,setError]=useState('');const[verifyingHash,setVerifyingHash]=useState('');const[verificationResults,setVerificationResults]=useState({});useEffect(()=>{const fetchFiles=async()=>{try{const response=await fetch('http://localhost:5000/api/upload/all');if(!response.ok){throw new Error('Failed to fetch files');}const data=await response.json();console.log(data);setFiles(data.files||[]);}catch(err){setError(err.message||'Something went wrong');}finally{setLoading(false);}};fetchFiles();},[]);const verifyFile=async hash=>{try{setVerifyingHash(hash);const provider=await getBrowserProvider();await ensureWalletConnected(provider);await ensureCorrectNetwork(provider);await ensureContractCode(provider);const contract=getReadOnlyContract(provider);const isVerified=await contract.verifyHash(hash);setVerificationResults(prev=>_objectSpread(_objectSpread({},prev),{},{[hash]:isVerified?'Verified':'Not Verified'}));}catch(err){setVerificationResults(prev=>_objectSpread(_objectSpread({},prev),{},{[hash]:(err===null||err===void 0?void 0:err.message)||'Verification Failed'}));}finally{setVerifyingHash('');}};return/*#__PURE__*/_jsx(\"div\",{className:\"min-h-screen bg-slate-100 px-4 py-10\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"mx-auto w-full max-w-5xl\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"mb-6 rounded-2xl bg-white p-6 shadow-sm\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-3xl font-bold text-slate-800\",children:\"All Uploaded Files\"}),/*#__PURE__*/_jsx(\"p\",{className:\"mt-2 text-sm text-slate-500\",children:\"Live list of files saved in your vault\"})]}),loading&&/*#__PURE__*/_jsx(\"div\",{className:\"rounded-2xl bg-white p-8 text-center text-slate-500 shadow-sm\",children:\"Loading files...\"}),!loading&&error&&/*#__PURE__*/_jsx(\"div\",{className:\"rounded-2xl border border-red-200 bg-red-50 p-4 text-red-700 shadow-sm\",children:error}),!loading&&!error&&files.length===0&&/*#__PURE__*/_jsx(\"div\",{className:\"rounded-2xl bg-white p-8 text-center text-slate-500 shadow-sm\",children:\"No files found.\"}),!loading&&!error&&files.length>0&&/*#__PURE__*/_jsx(\"div\",{className:\"overflow-hidden rounded-2xl bg-white shadow-sm\",children:/*#__PURE__*/_jsx(\"div\",{className:\"overflow-x-auto\",children:/*#__PURE__*/_jsxs(\"table\",{className:\"min-w-full divide-y divide-slate-200\",children:[/*#__PURE__*/_jsx(\"thead\",{className:\"bg-slate-50\",children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-3 text-left text-xs font-semibold uppercase tracking-wider text-slate-600\",children:\"Action\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-3 text-left text-xs font-semibold uppercase tracking-wider text-slate-600\",children:\"File Name\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-3 text-left text-xs font-semibold uppercase tracking-wider text-slate-600\",children:\"Owner\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-3 text-left text-xs font-semibold uppercase tracking-wider text-slate-600\",children:\"IPFS Hash\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-3 text-left text-xs font-semibold uppercase tracking-wider text-slate-600\",children:\"Uploaded At\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{className:\"divide-y divide-slate-100\",children:files.map(item=>/*#__PURE__*/_jsxs(\"tr\",{className:\"hover:bg-slate-50\",children:[/*#__PURE__*/_jsxs(\"td\",{className:\"px-6 py-4 text-sm\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2\",children:[/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>window.open(\"https://gateway.pinata.cloud/ipfs/\".concat(item.ipfshash),'_blank','noopener,noreferrer'),className:\"rounded-md bg-blue-600 px-3 py-1.5 text-xs font-semibold text-white transition hover:bg-blue-700\",children:\"Open\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>verifyFile(item.ipfshash),disabled:verifyingHash===item.ipfshash,className:\"rounded-md px-3 py-1.5 text-xs font-semibold text-white transition \".concat(verifyingHash===item.ipfshash?'bg-slate-400 cursor-not-allowed':'bg-emerald-600 hover:bg-emerald-700'),children:verifyingHash===item.ipfshash?'Verifying...':'Verify'})]}),verificationResults[item.ipfshash]&&/*#__PURE__*/_jsx(\"p\",{className:\"mt-2 text-xs \".concat(verificationResults[item.ipfshash]==='Verified'?'text-emerald-700':'text-red-600'),children:verificationResults[item.ipfshash]})]}),/*#__PURE__*/_jsx(\"td\",{className:\"px-6 py-4 text-sm font-medium text-slate-800\",children:item.filename}),/*#__PURE__*/_jsx(\"td\",{className:\"px-6 py-4 text-sm text-slate-700\",children:item.userID}),/*#__PURE__*/_jsx(\"td\",{className:\"px-6 py-4 font-mono text-xs text-slate-600\",children:item.ipfshash}),/*#__PURE__*/_jsx(\"td\",{className:\"px-6 py-4 text-sm text-slate-700\",children:item.uploadedAt?new Date(item.uploadedAt).toLocaleString():'-'})]},item._id))})]})})})]})});}export default FilesPage;","map":{"version":3,"names":["React","useEffect","useState","ensureContractCode","ensureCorrectNetwork","ensureWalletConnected","getBrowserProvider","getReadOnlyContract","jsx","_jsx","jsxs","_jsxs","FilesPage","files","setFiles","loading","setLoading","error","setError","verifyingHash","setVerifyingHash","verificationResults","setVerificationResults","fetchFiles","response","fetch","ok","Error","data","json","console","log","err","message","verifyFile","hash","provider","contract","isVerified","verifyHash","prev","_objectSpread","className","children","length","map","item","type","onClick","window","open","concat","ipfshash","disabled","filename","userID","uploadedAt","Date","toLocaleString","_id"],"sources":["C:/Users/ahmad/OneDrive/Desktop/evault/frontend/src/components/FilesPage.js"],"sourcesContent":["import React, { useEffect, useState } from 'react';\nimport {\n  ensureContractCode,\n  ensureCorrectNetwork,\n  ensureWalletConnected,\n  getBrowserProvider,\n  getReadOnlyContract,\n} from '../contract/eth.js';\n\nfunction FilesPage() {\n  const [files, setFiles] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState('');\n  const [verifyingHash, setVerifyingHash] = useState('');\n  const [verificationResults, setVerificationResults] = useState({});\n\n  useEffect(() => {\n    const fetchFiles = async () => {\n      try {\n        const response = await fetch('http://localhost:5000/api/upload/all');\n\n        if (!response.ok) {\n          throw new Error('Failed to fetch files');\n        }\n\n        const data = await response.json();\n        console.log(data)\n        setFiles(data.files || []);\n      } catch (err) {\n        setError(err.message || 'Something went wrong');\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    fetchFiles();\n  }, []);\n\n  const verifyFile = async (hash) => {\n    try {\n      setVerifyingHash(hash);\n\n      const provider = await getBrowserProvider();\n      await ensureWalletConnected(provider);\n      await ensureCorrectNetwork(provider);\n      await ensureContractCode(provider);\n      const contract = getReadOnlyContract(provider);\n      const isVerified = await contract.verifyHash(hash);\n\n      setVerificationResults((prev) => ({\n        ...prev,\n        [hash]: isVerified ? 'Verified' : 'Not Verified',\n      }));\n    } catch (err) {\n      setVerificationResults((prev) => ({\n        ...prev,\n        [hash]: err?.message || 'Verification Failed',\n      }));\n    } finally {\n      setVerifyingHash('');\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen bg-slate-100 px-4 py-10\">\n      <div className=\"mx-auto w-full max-w-5xl\">\n        <div className=\"mb-6 rounded-2xl bg-white p-6 shadow-sm\">\n          <h1 className=\"text-3xl font-bold text-slate-800\">All Uploaded Files</h1>\n          <p className=\"mt-2 text-sm text-slate-500\">Live list of files saved in your vault</p>\n        </div>\n\n        {loading && (\n          <div className=\"rounded-2xl bg-white p-8 text-center text-slate-500 shadow-sm\">\n            Loading files...\n          </div>\n        )}\n\n        {!loading && error && (\n          <div className=\"rounded-2xl border border-red-200 bg-red-50 p-4 text-red-700 shadow-sm\">\n            {error}\n          </div>\n        )}\n\n        {!loading && !error && files.length === 0 && (\n          <div className=\"rounded-2xl bg-white p-8 text-center text-slate-500 shadow-sm\">\n            No files found.\n          </div>\n        )}\n\n        {!loading && !error && files.length > 0 && (\n          <div className=\"overflow-hidden rounded-2xl bg-white shadow-sm\">\n            <div className=\"overflow-x-auto\">\n              <table className=\"min-w-full divide-y divide-slate-200\">\n                <thead className=\"bg-slate-50\">\n                  <tr>\n                    <th className=\"px-6 py-3 text-left text-xs font-semibold uppercase tracking-wider text-slate-600\">\n                      Action\n                    </th>\n                    <th className=\"px-6 py-3 text-left text-xs font-semibold uppercase tracking-wider text-slate-600\">\n                      File Name\n                    </th>\n                    <th className=\"px-6 py-3 text-left text-xs font-semibold uppercase tracking-wider text-slate-600\">\n                      Owner\n                    </th>\n                    <th className=\"px-6 py-3 text-left text-xs font-semibold uppercase tracking-wider text-slate-600\">\n                      IPFS Hash\n                    </th>\n                    <th className=\"px-6 py-3 text-left text-xs font-semibold uppercase tracking-wider text-slate-600\">\n                      Uploaded At\n                    </th>\n                  </tr>\n                </thead>\n                <tbody className=\"divide-y divide-slate-100\">\n                  {files.map((item) => (\n                    <tr key={item._id} className=\"hover:bg-slate-50\">\n                      <td className=\"px-6 py-4 text-sm\">\n                        <div className=\"flex items-center gap-2\">\n                          <button\n                            type=\"button\"\n                            onClick={() => window.open(`https://gateway.pinata.cloud/ipfs/${item.ipfshash}`, '_blank', 'noopener,noreferrer')}\n                            className=\"rounded-md bg-blue-600 px-3 py-1.5 text-xs font-semibold text-white transition hover:bg-blue-700\"\n                          >\n                            Open\n                          </button>\n                          <button\n                            type=\"button\"\n                            onClick={() => verifyFile(item.ipfshash)}\n                            disabled={verifyingHash === item.ipfshash}\n                            className={`rounded-md px-3 py-1.5 text-xs font-semibold text-white transition ${\n                              verifyingHash === item.ipfshash\n                                ? 'bg-slate-400 cursor-not-allowed'\n                                : 'bg-emerald-600 hover:bg-emerald-700'\n                            }`}\n                          >\n                            {verifyingHash === item.ipfshash ? 'Verifying...' : 'Verify'}\n                          </button>\n                        </div>\n                        {verificationResults[item.ipfshash] && (\n                          <p\n                            className={`mt-2 text-xs ${\n                              verificationResults[item.ipfshash] === 'Verified'\n                                ? 'text-emerald-700'\n                                : 'text-red-600'\n                            }`}\n                          >\n                            {verificationResults[item.ipfshash]}\n                          </p>\n                        )}\n                      </td>\n                      <td className=\"px-6 py-4 text-sm font-medium text-slate-800\">{item.filename}</td>\n                      <td className=\"px-6 py-4 text-sm text-slate-700\">{item.userID}</td>\n                      <td className=\"px-6 py-4 font-mono text-xs text-slate-600\">{item.ipfshash}</td>\n                      <td className=\"px-6 py-4 text-sm text-slate-700\">\n                        {item.uploadedAt ? new Date(item.uploadedAt).toLocaleString() : '-'}\n                      </td>\n                    </tr>\n                  ))}\n                </tbody>\n              </table>\n            </div>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n\nexport default FilesPage;\n"],"mappings":"2HAAA,MAAO,CAAAA,KAAK,EAAIC,SAAS,CAAEC,QAAQ,KAAQ,OAAO,CAClD,OACEC,kBAAkB,CAClBC,oBAAoB,CACpBC,qBAAqB,CACrBC,kBAAkB,CAClBC,mBAAmB,KACd,oBAAoB,CAAC,OAAAC,GAAA,IAAAC,IAAA,CAAAC,IAAA,IAAAC,KAAA,yBAE5B,QAAS,CAAAC,SAASA,CAAA,CAAG,CACnB,KAAM,CAACC,KAAK,CAAEC,QAAQ,CAAC,CAAGZ,QAAQ,CAAC,EAAE,CAAC,CACtC,KAAM,CAACa,OAAO,CAAEC,UAAU,CAAC,CAAGd,QAAQ,CAAC,IAAI,CAAC,CAC5C,KAAM,CAACe,KAAK,CAAEC,QAAQ,CAAC,CAAGhB,QAAQ,CAAC,EAAE,CAAC,CACtC,KAAM,CAACiB,aAAa,CAAEC,gBAAgB,CAAC,CAAGlB,QAAQ,CAAC,EAAE,CAAC,CACtD,KAAM,CAACmB,mBAAmB,CAAEC,sBAAsB,CAAC,CAAGpB,QAAQ,CAAC,CAAC,CAAC,CAAC,CAElED,SAAS,CAAC,IAAM,CACd,KAAM,CAAAsB,UAAU,CAAG,KAAAA,CAAA,GAAY,CAC7B,GAAI,CACF,KAAM,CAAAC,QAAQ,CAAG,KAAM,CAAAC,KAAK,CAAC,sCAAsC,CAAC,CAEpE,GAAI,CAACD,QAAQ,CAACE,EAAE,CAAE,CAChB,KAAM,IAAI,CAAAC,KAAK,CAAC,uBAAuB,CAAC,CAC1C,CAEA,KAAM,CAAAC,IAAI,CAAG,KAAM,CAAAJ,QAAQ,CAACK,IAAI,CAAC,CAAC,CAClCC,OAAO,CAACC,GAAG,CAACH,IAAI,CAAC,CACjBd,QAAQ,CAACc,IAAI,CAACf,KAAK,EAAI,EAAE,CAAC,CAC5B,CAAE,MAAOmB,GAAG,CAAE,CACZd,QAAQ,CAACc,GAAG,CAACC,OAAO,EAAI,sBAAsB,CAAC,CACjD,CAAC,OAAS,CACRjB,UAAU,CAAC,KAAK,CAAC,CACnB,CACF,CAAC,CAEDO,UAAU,CAAC,CAAC,CACd,CAAC,CAAE,EAAE,CAAC,CAEN,KAAM,CAAAW,UAAU,CAAG,KAAO,CAAAC,IAAI,EAAK,CACjC,GAAI,CACFf,gBAAgB,CAACe,IAAI,CAAC,CAEtB,KAAM,CAAAC,QAAQ,CAAG,KAAM,CAAA9B,kBAAkB,CAAC,CAAC,CAC3C,KAAM,CAAAD,qBAAqB,CAAC+B,QAAQ,CAAC,CACrC,KAAM,CAAAhC,oBAAoB,CAACgC,QAAQ,CAAC,CACpC,KAAM,CAAAjC,kBAAkB,CAACiC,QAAQ,CAAC,CAClC,KAAM,CAAAC,QAAQ,CAAG9B,mBAAmB,CAAC6B,QAAQ,CAAC,CAC9C,KAAM,CAAAE,UAAU,CAAG,KAAM,CAAAD,QAAQ,CAACE,UAAU,CAACJ,IAAI,CAAC,CAElDb,sBAAsB,CAAEkB,IAAI,EAAAC,aAAA,CAAAA,aAAA,IACvBD,IAAI,MACP,CAACL,IAAI,EAAGG,UAAU,CAAG,UAAU,CAAG,cAAc,EAChD,CAAC,CACL,CAAE,MAAON,GAAG,CAAE,CACZV,sBAAsB,CAAEkB,IAAI,EAAAC,aAAA,CAAAA,aAAA,IACvBD,IAAI,MACP,CAACL,IAAI,EAAG,CAAAH,GAAG,SAAHA,GAAG,iBAAHA,GAAG,CAAEC,OAAO,GAAI,qBAAqB,EAC7C,CAAC,CACL,CAAC,OAAS,CACRb,gBAAgB,CAAC,EAAE,CAAC,CACtB,CACF,CAAC,CAED,mBACEX,IAAA,QAAKiC,SAAS,CAAC,sCAAsC,CAAAC,QAAA,cACnDhC,KAAA,QAAK+B,SAAS,CAAC,0BAA0B,CAAAC,QAAA,eACvChC,KAAA,QAAK+B,SAAS,CAAC,yCAAyC,CAAAC,QAAA,eACtDlC,IAAA,OAAIiC,SAAS,CAAC,mCAAmC,CAAAC,QAAA,CAAC,oBAAkB,CAAI,CAAC,cACzElC,IAAA,MAAGiC,SAAS,CAAC,6BAA6B,CAAAC,QAAA,CAAC,wCAAsC,CAAG,CAAC,EAClF,CAAC,CAEL5B,OAAO,eACNN,IAAA,QAAKiC,SAAS,CAAC,+DAA+D,CAAAC,QAAA,CAAC,kBAE/E,CAAK,CACN,CAEA,CAAC5B,OAAO,EAAIE,KAAK,eAChBR,IAAA,QAAKiC,SAAS,CAAC,wEAAwE,CAAAC,QAAA,CACpF1B,KAAK,CACH,CACN,CAEA,CAACF,OAAO,EAAI,CAACE,KAAK,EAAIJ,KAAK,CAAC+B,MAAM,GAAK,CAAC,eACvCnC,IAAA,QAAKiC,SAAS,CAAC,+DAA+D,CAAAC,QAAA,CAAC,iBAE/E,CAAK,CACN,CAEA,CAAC5B,OAAO,EAAI,CAACE,KAAK,EAAIJ,KAAK,CAAC+B,MAAM,CAAG,CAAC,eACrCnC,IAAA,QAAKiC,SAAS,CAAC,gDAAgD,CAAAC,QAAA,cAC7DlC,IAAA,QAAKiC,SAAS,CAAC,iBAAiB,CAAAC,QAAA,cAC9BhC,KAAA,UAAO+B,SAAS,CAAC,sCAAsC,CAAAC,QAAA,eACrDlC,IAAA,UAAOiC,SAAS,CAAC,aAAa,CAAAC,QAAA,cAC5BhC,KAAA,OAAAgC,QAAA,eACElC,IAAA,OAAIiC,SAAS,CAAC,mFAAmF,CAAAC,QAAA,CAAC,QAElG,CAAI,CAAC,cACLlC,IAAA,OAAIiC,SAAS,CAAC,mFAAmF,CAAAC,QAAA,CAAC,WAElG,CAAI,CAAC,cACLlC,IAAA,OAAIiC,SAAS,CAAC,mFAAmF,CAAAC,QAAA,CAAC,OAElG,CAAI,CAAC,cACLlC,IAAA,OAAIiC,SAAS,CAAC,mFAAmF,CAAAC,QAAA,CAAC,WAElG,CAAI,CAAC,cACLlC,IAAA,OAAIiC,SAAS,CAAC,mFAAmF,CAAAC,QAAA,CAAC,aAElG,CAAI,CAAC,EACH,CAAC,CACA,CAAC,cACRlC,IAAA,UAAOiC,SAAS,CAAC,2BAA2B,CAAAC,QAAA,CACzC9B,KAAK,CAACgC,GAAG,CAAEC,IAAI,eACdnC,KAAA,OAAmB+B,SAAS,CAAC,mBAAmB,CAAAC,QAAA,eAC9ChC,KAAA,OAAI+B,SAAS,CAAC,mBAAmB,CAAAC,QAAA,eAC/BhC,KAAA,QAAK+B,SAAS,CAAC,yBAAyB,CAAAC,QAAA,eACtClC,IAAA,WACEsC,IAAI,CAAC,QAAQ,CACbC,OAAO,CAAEA,CAAA,GAAMC,MAAM,CAACC,IAAI,sCAAAC,MAAA,CAAsCL,IAAI,CAACM,QAAQ,EAAI,QAAQ,CAAE,qBAAqB,CAAE,CAClHV,SAAS,CAAC,kGAAkG,CAAAC,QAAA,CAC7G,MAED,CAAQ,CAAC,cACTlC,IAAA,WACEsC,IAAI,CAAC,QAAQ,CACbC,OAAO,CAAEA,CAAA,GAAMd,UAAU,CAACY,IAAI,CAACM,QAAQ,CAAE,CACzCC,QAAQ,CAAElC,aAAa,GAAK2B,IAAI,CAACM,QAAS,CAC1CV,SAAS,uEAAAS,MAAA,CACPhC,aAAa,GAAK2B,IAAI,CAACM,QAAQ,CAC3B,iCAAiC,CACjC,qCAAqC,CACxC,CAAAT,QAAA,CAEFxB,aAAa,GAAK2B,IAAI,CAACM,QAAQ,CAAG,cAAc,CAAG,QAAQ,CACtD,CAAC,EACN,CAAC,CACL/B,mBAAmB,CAACyB,IAAI,CAACM,QAAQ,CAAC,eACjC3C,IAAA,MACEiC,SAAS,iBAAAS,MAAA,CACP9B,mBAAmB,CAACyB,IAAI,CAACM,QAAQ,CAAC,GAAK,UAAU,CAC7C,kBAAkB,CAClB,cAAc,CACjB,CAAAT,QAAA,CAEFtB,mBAAmB,CAACyB,IAAI,CAACM,QAAQ,CAAC,CAClC,CACJ,EACC,CAAC,cACL3C,IAAA,OAAIiC,SAAS,CAAC,8CAA8C,CAAAC,QAAA,CAAEG,IAAI,CAACQ,QAAQ,CAAK,CAAC,cACjF7C,IAAA,OAAIiC,SAAS,CAAC,kCAAkC,CAAAC,QAAA,CAAEG,IAAI,CAACS,MAAM,CAAK,CAAC,cACnE9C,IAAA,OAAIiC,SAAS,CAAC,4CAA4C,CAAAC,QAAA,CAAEG,IAAI,CAACM,QAAQ,CAAK,CAAC,cAC/E3C,IAAA,OAAIiC,SAAS,CAAC,kCAAkC,CAAAC,QAAA,CAC7CG,IAAI,CAACU,UAAU,CAAG,GAAI,CAAAC,IAAI,CAACX,IAAI,CAACU,UAAU,CAAC,CAACE,cAAc,CAAC,CAAC,CAAG,GAAG,CACjE,CAAC,GAxCEZ,IAAI,CAACa,GAyCV,CACL,CAAC,CACG,CAAC,EACH,CAAC,CACL,CAAC,CACH,CACN,EACE,CAAC,CACH,CAAC,CAEV,CAEA,cAAe,CAAA/C,SAAS","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}