{"ast":null,"code":"import _objectSpread from\"C:/Users/ahmad/OneDrive/Desktop/evault/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useEffect,useState}from\"react\";import{Link}from\"react-router-dom\";import{useNavigate}from\"react-router-dom\";import AdminPanel from\"../components/AdminPanel.js\";import{approvePropertyOnChain,getPropertyHistoryOnChain,getPropertyOwnerOnChain,getWalletRoleOnChain,grantRegistrarOnChain,isWalletRegistrarOnChain,propertyExistsOnChain,revokeRegistrarOnChain,verifyPropertyOnChain}from\"../contract/propertyActions.js\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const API_BASE=\"http://localhost:5000\";const ZERO_ADDRESS=\"0x0000000000000000000000000000000000000000\";async function parseJsonSafe(response){const contentType=response.headers.get(\"content-type\")||\"\";if(!contentType.includes(\"application/json\")){const text=await response.text();throw new Error(\"API did not return JSON. Response started with: \".concat(text.slice(0,40)));}return response.json();}function maskHash(hash){const value=String(hash||\"\").trim();if(!value)return\"-\";if(value.length<=14)return value;return\"\".concat(value.slice(0,8),\"...\").concat(value.slice(-6));}function maskValue(value){const text=String(value||\"\").trim();if(!text)return\"-\";if(text.length<=10)return text;return\"\".concat(text.slice(0,4),\"...\").concat(text.slice(-4));}function RegistrarDashboard(){const navigate=useNavigate();const[files,setFiles]=useState([]);const[loading,setLoading]=useState(false);const[actionMessage,setActionMessage]=useState(\"\");const[processingHash,setProcessingHash]=useState(\"\");const[walletInfo,setWalletInfo]=useState({wallet:\"\",adminAddress:\"\",isRegistrar:false,isAdmin:false});const[granting,setGranting]=useState(false);const[revoking,setRevoking]=useState(false);const[grantAddress,setGrantAddress]=useState(\"\");const[registrarUsers,setRegistrarUsers]=useState([]);const[loadingRegistrars,setLoadingRegistrars]=useState(false);const[historyByHash,setHistoryByHash]=useState({});const[loadingHistoryHash,setLoadingHistoryHash]=useState(\"\");const[searchHash,setSearchHash]=useState(\"\");const[searchingOwner,setSearchingOwner]=useState(false);const[ownerDetails,setOwnerDetails]=useState(null);const[ownerSearchMessage,setOwnerSearchMessage]=useState(\"\");const logout=()=>{localStorage.removeItem(\"user\");localStorage.removeItem(\"role\");navigate(\"/login\",{replace:true});};const loadFiles=async()=>{setLoading(true);try{var _data2;let response=await fetch(\"\".concat(API_BASE,\"/api/files?role=registrar\"),{headers:{\"x-role\":\"registrar\"}});let data;try{data=await parseJsonSafe(response);}catch(_unused){// Backward-compatible fallback to existing upload listing endpoint.\nresponse=await fetch(\"\".concat(API_BASE,\"/api/upload/all\"));data=await parseJsonSafe(response);}if(!response.ok){var _data;throw new Error(((_data=data)===null||_data===void 0?void 0:_data.message)||\"Failed to fetch files\");}const rows=Array.isArray((_data2=data)===null||_data2===void 0?void 0:_data2.files)?data.files:[];const withStatus=await Promise.all(rows.map(async item=>{let existsOnChain=null;let verifiedOnChain=false;let currentOwnerWallet=item.currentOwnerWallet||null;let transferHistoryCount=null;try{existsOnChain=await propertyExistsOnChain(item.ipfshash);}catch(_unused2){existsOnChain=null;}try{verifiedOnChain=await verifyPropertyOnChain(item.ipfshash);}catch(_unused3){verifiedOnChain=false;}try{currentOwnerWallet=await getPropertyOwnerOnChain(item.ipfshash);}catch(_unused4){// no-op\n}try{const history=await getPropertyHistoryOnChain(item.ipfshash);transferHistoryCount=Array.isArray(history)?history.filter(record=>{const from=String((record===null||record===void 0?void 0:record.from)||\"\").toLowerCase();const to=String((record===null||record===void 0?void 0:record.to)||\"\").toLowerCase();return from&&to&&from!==ZERO_ADDRESS&&to!==ZERO_ADDRESS;}).length:0;}catch(_unused5){transferHistoryCount=null;}return _objectSpread(_objectSpread({},item),{},{existsOnChain,verifiedOnChain:Boolean(verifiedOnChain),currentOwnerWallet,transferHistoryCount});}));setFiles(withStatus);}catch(error){setActionMessage((error===null||error===void 0?void 0:error.message)||\"Failed to load files. Ensure backend is running on http://localhost:5000.\");}finally{setLoading(false);}};const loadWalletRole=async()=>{try{const info=await getWalletRoleOnChain();setWalletInfo(info);setGrantAddress(info.wallet||\"\");if(!info.isRegistrar){setActionMessage(\"Connected wallet \".concat(info.wallet,\" is not registrar on-chain. Approval will fail until added by admin.\"));}}catch(error){setActionMessage((error===null||error===void 0?void 0:error.message)||\"Failed to read wallet role from blockchain.\");}};const loadRegistrarUsers=async()=>{try{setLoadingRegistrars(true);const response=await fetch(\"\".concat(API_BASE,\"/api/auth/registrars\"));const contentType=response.headers.get(\"content-type\")||\"\";if(!contentType.includes(\"application/json\")){setRegistrarUsers([]);setActionMessage(\"Registrar management endpoint is unavailable (non-JSON response). Restart backend and try again.\");return;}const data=await response.json();if(!response.ok){throw new Error((data===null||data===void 0?void 0:data.error)||\"Failed to load registrar users\");}const rows=Array.isArray(data===null||data===void 0?void 0:data.registrars)?data.registrars:[];const withStatus=await Promise.all(rows.map(async item=>{const wallet=String(item.walletAddress||\"\").trim();let isRegistrarOnChain=false;if(wallet){try{isRegistrarOnChain=await isWalletRegistrarOnChain(wallet);}catch(_unused6){isRegistrarOnChain=false;}}return _objectSpread(_objectSpread({},item),{},{isRegistrarOnChain});}));setRegistrarUsers(withStatus);}catch(error){setActionMessage((error===null||error===void 0?void 0:error.message)||\"Failed to load registrar users.\");}finally{setLoadingRegistrars(false);}};useEffect(()=>{loadWalletRole();loadFiles();loadRegistrarUsers();},[]);const approve=async hash=>{try{setProcessingHash(hash);setActionMessage(\"Approving property on blockchain...\");await approvePropertyOnChain(hash);await fetch(\"\".concat(API_BASE,\"/api/files/verify\"),{method:\"PATCH\",headers:{\"Content-Type\":\"application/json\",\"x-role\":\"registrar\"},body:JSON.stringify({hash,role:\"registrar\",verifiedBy:walletInfo.wallet||null})});setActionMessage(\"Property approved successfully.\");setFiles(prev=>prev.map(item=>item.ipfshash===hash?_objectSpread(_objectSpread({},item),{},{existsOnChain:true,verifiedOnChain:true,verified:true,verifiedAt:new Date().toISOString(),verifiedBy:walletInfo.wallet||item.verifiedBy}):item));}catch(error){const message=String((error===null||error===void 0?void 0:error.message)||\"\");if(message.includes(\"Property not found\")){setActionMessage(\"Property hash not registered on blockchain. Citizen must upload/register hash first.\");}else{setActionMessage(message||\"Approval failed\");}}finally{setProcessingHash(\"\");}};const grantRegistrar=async targetWalletAddress=>{try{const nextAddress=String(targetWalletAddress||grantAddress||\"\").trim();if(!nextAddress){setActionMessage(\"Enter a wallet address to grant registrar role.\");return;}setGranting(true);setActionMessage(\"Granting registrar role on-chain...\");await grantRegistrarOnChain(nextAddress);if(nextAddress.toLowerCase()===walletInfo.wallet.toLowerCase()){setWalletInfo(prev=>_objectSpread(_objectSpread({},prev),{},{isRegistrar:true}));}await loadRegistrarUsers();setActionMessage(\"Registrar role granted to \".concat(nextAddress,\".\"));}catch(error){setActionMessage((error===null||error===void 0?void 0:error.message)||\"Failed to grant registrar role.\");}finally{setGranting(false);}};const revokeRegistrar=async targetWalletAddress=>{try{const nextAddress=String(targetWalletAddress||\"\").trim();if(!nextAddress){setActionMessage(\"Enter a wallet address to revoke registrar role.\");return;}if(nextAddress.toLowerCase()===String(walletInfo.adminAddress||\"\").toLowerCase()){setActionMessage(\"Admin registrar role cannot be revoked.\");return;}setRevoking(true);setActionMessage(\"Revoking registrar role on-chain...\");await revokeRegistrarOnChain(nextAddress);if(nextAddress.toLowerCase()===String(walletInfo.wallet||\"\").toLowerCase()){setWalletInfo(prev=>_objectSpread(_objectSpread({},prev),{},{isRegistrar:false}));}await loadRegistrarUsers();setActionMessage(\"Registrar role revoked for \".concat(nextAddress,\".\"));}catch(error){setActionMessage((error===null||error===void 0?void 0:error.message)||\"Failed to revoke registrar role.\");}finally{setRevoking(false);}};const loadHistory=async hash=>{try{setLoadingHistoryHash(hash);const history=await getPropertyHistoryOnChain(hash);setHistoryByHash(prev=>_objectSpread(_objectSpread({},prev),{},{[hash]:history}));}catch(error){setActionMessage((error===null||error===void 0?void 0:error.message)||\"Failed to fetch property history\");}finally{setLoadingHistoryHash(\"\");}};const searchOwnerByHash=async()=>{const value=String(searchHash||\"\").trim();if(!value){setOwnerSearchMessage(\"Enter property hash first.\");setOwnerDetails(null);return;}try{setSearchingOwner(true);setOwnerSearchMessage(\"\");setOwnerDetails(null);const response=await fetch(\"\".concat(API_BASE,\"/api/property/\").concat(encodeURIComponent(value),\"?role=registrar\"),{headers:{\"x-role\":\"registrar\"}});const data=await parseJsonSafe(response);if(!response.ok){throw new Error((data===null||data===void 0?void 0:data.message)||\"Failed to search property owner\");}setOwnerDetails(data);}catch(error){setOwnerSearchMessage((error===null||error===void 0?void 0:error.message)||\"Failed to search owner by hash.\");}finally{setSearchingOwner(false);}};const copyHash=async hash=>{const value=String(hash||\"\").trim();if(!value)return;try{await navigator.clipboard.writeText(value);setActionMessage(\"Property hash copied.\");}catch(_unused7){setActionMessage(\"Copy failed. Please copy manually.\");}};return/*#__PURE__*/_jsx(\"div\",{className:\"min-h-screen bg-gradient-to-br from-slate-100 via-slate-50 to-sky-100 p-4 md:p-6\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"mx-auto max-w-7xl space-y-6\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"rounded-2xl bg-white p-6 shadow-lg ring-1 ring-slate-200\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-2xl font-bold tracking-tight text-slate-900\",children:\"Registrar Dashboard\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-slate-600\",children:\"Review, verify, and track property records.\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2\",children:[/*#__PURE__*/_jsx(Link,{to:\"/user-lookup\",className:\"rounded-xl bg-sky-600 px-4 py-2 text-sm font-semibold text-white shadow hover:bg-sky-700\",children:\"User Lookup\"}),/*#__PURE__*/_jsx(Link,{to:\"/explorer\",className:\"rounded-xl bg-indigo-600 px-4 py-2 text-sm font-semibold text-white shadow hover:bg-indigo-700\",children:\"Explorer\"}),/*#__PURE__*/_jsx(\"button\",{onClick:logout,className:\"rounded-xl bg-rose-600 px-4 py-2 text-sm font-semibold text-white shadow hover:bg-rose-700\",children:\"Logout\"})]})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"grid gap-6 lg:grid-cols-2\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"rounded-2xl bg-white p-6 shadow-lg ring-1 ring-slate-200\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-lg font-semibold text-slate-900\",children:\"Search By Property Hash\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-3 flex flex-col gap-2 sm:flex-row\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:searchHash,onChange:e=>setSearchHash(e.target.value),placeholder:\"Enter property hash\",className:\"w-full rounded-xl border border-slate-300 px-3 py-2 text-xs outline-none focus:border-indigo-500\"}),/*#__PURE__*/_jsx(\"button\",{onClick:searchOwnerByHash,disabled:searchingOwner,className:\"rounded-xl px-4 py-2 text-xs font-semibold text-white \".concat(searchingOwner?\"cursor-not-allowed bg-slate-400\":\"bg-indigo-600 hover:bg-indigo-700\"),children:searchingOwner?\"Searching...\":\"Search\"})]}),ownerSearchMessage&&/*#__PURE__*/_jsx(\"p\",{className:\"mt-3 rounded-lg border border-rose-200 bg-rose-50 px-3 py-2 text-xs text-rose-700\",children:ownerSearchMessage}),ownerDetails&&/*#__PURE__*/_jsxs(\"div\",{className:\"mt-3 rounded-xl border border-slate-200 bg-slate-50 p-4\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-xs font-semibold uppercase tracking-wide text-slate-700\",children:\"Owner Details\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"mt-2 break-all text-xs text-slate-700\",children:[\"Wallet: \",/*#__PURE__*/_jsx(\"span\",{className:\"font-mono\",children:ownerDetails.walletAddress||\"-\"})]}),/*#__PURE__*/_jsxs(\"p\",{className:\"mt-1 text-xs text-slate-700\",children:[\"Name: \",ownerDetails.name||\"-\"]}),/*#__PURE__*/_jsxs(\"p\",{className:\"mt-1 text-xs text-slate-700\",children:[\"Role: \",ownerDetails.role||\"-\"]}),/*#__PURE__*/_jsxs(\"p\",{className:\"mt-1 text-xs text-slate-700\",children:[\"Aadhaar: \",ownerDetails.aadhaar||\"-\"]})]})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"rounded-2xl bg-white p-6 shadow-lg ring-1 ring-slate-200\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-lg font-semibold text-slate-900\",children:\"Property Queue\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-3 rounded-xl border border-indigo-200 bg-indigo-50 p-3 text-xs text-indigo-900\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"font-semibold\",children:\"Registrar Workflow\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"mt-1\",children:[\"1) If status is \",/*#__PURE__*/_jsx(\"span\",{className:\"font-semibold\",children:\"Missing On-Chain\"}),\", property hash is not registered yet.\"]}),/*#__PURE__*/_jsx(\"p\",{className:\"mt-1\",children:\"2) Only after on-chain registration, registrar can approve verification.\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"mt-1\",children:[\"3) Use \",/*#__PURE__*/_jsx(\"span\",{className:\"font-semibold\",children:\"View History\"}),\" to review transfer ownership trail.\"]})]}),actionMessage&&/*#__PURE__*/_jsx(\"p\",{className:\"mt-3 rounded-lg border border-sky-200 bg-sky-50 px-3 py-2 text-sm text-sky-800\",children:actionMessage}),loading?/*#__PURE__*/_jsx(\"p\",{className:\"mt-4 text-sm text-slate-500\",children:\"Loading documents...\"}):files.length===0?/*#__PURE__*/_jsx(\"p\",{className:\"mt-4 text-sm text-slate-500\",children:\"No uploaded files found.\"}):/*#__PURE__*/_jsx(\"div\",{className:\"mt-4 overflow-x-auto rounded-xl border border-slate-200\",children:/*#__PURE__*/_jsxs(\"table\",{className:\"min-w-full divide-y divide-slate-200\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{className:\"bg-slate-50 text-left text-xs uppercase tracking-wide text-slate-600\",children:[/*#__PURE__*/_jsx(\"th\",{className:\"px-3 py-2\",children:\"File\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-3 py-2\",children:\"Owner ID\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-3 py-2\",children:\"Hash\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-3 py-2\",children:\"Current Owner\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-3 py-2\",children:\"Flow\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-3 py-2\",children:\"Status\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-3 py-2\",children:\"Action\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{className:\"divide-y divide-slate-100 bg-white\",children:files.map(item=>/*#__PURE__*/_jsxs(React.Fragment,{children:[/*#__PURE__*/_jsxs(\"tr\",{className:\"hover:bg-slate-50\",children:[/*#__PURE__*/_jsx(\"td\",{className:\"px-3 py-2 text-sm text-slate-800\",children:item.filename}),/*#__PURE__*/_jsx(\"td\",{className:\"px-3 py-2\",children:/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>copyHash(item.userID),title:item.userID,className:\"text-sm text-slate-700 underline decoration-dotted underline-offset-2 hover:text-indigo-700\",children:maskValue(item.userID)})}),/*#__PURE__*/_jsx(\"td\",{className:\"px-3 py-2\",children:/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>copyHash(item.ipfshash),title:item.ipfshash,className:\"font-mono text-xs text-slate-700 underline decoration-dotted underline-offset-2 hover:text-indigo-700\",children:maskHash(item.ipfshash)})}),/*#__PURE__*/_jsx(\"td\",{className:\"px-3 py-2\",children:/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>copyHash(item.currentOwnerWallet),title:item.currentOwnerWallet||\"-\",className:\"font-mono text-xs text-slate-700 underline decoration-dotted underline-offset-2 hover:text-indigo-700\",children:maskValue(item.currentOwnerWallet)})}),/*#__PURE__*/_jsx(\"td\",{className:\"px-3 py-2 text-xs text-slate-700\",children:item.existsOnChain===false?\"Registration Pending\":Number(item.transferHistoryCount||0)>0?\"Transferred Property\":\"New Registration\"}),/*#__PURE__*/_jsx(\"td\",{className:\"px-3 py-2 text-sm\",children:/*#__PURE__*/_jsx(\"span\",{className:item.verified||item.verifiedOnChain?\"text-emerald-700 font-medium\":item.existsOnChain===false?\"text-rose-700 font-medium\":item.existsOnChain?\"text-amber-700 font-medium\":\"text-amber-700 font-medium\",children:item.verified||item.verifiedOnChain?\"Verified\":item.existsOnChain===false?\"Not Registered\":\"Pending Approval\"})}),/*#__PURE__*/_jsx(\"td\",{className:\"px-3 py-2\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col gap-2\",children:[/*#__PURE__*/_jsx(\"a\",{href:\"https://gateway.pinata.cloud/ipfs/\".concat(item.ipfshash),target:\"_blank\",rel:\"noreferrer\",className:\"rounded-lg bg-indigo-600 px-3 py-1.5 text-center text-xs font-semibold text-white hover:bg-indigo-700\",children:\"View Document\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>approve(item.ipfshash),disabled:item.existsOnChain===false||item.verified||item.verifiedOnChain||processingHash===item.ipfshash||!walletInfo.isRegistrar,className:\"rounded-lg px-3 py-1.5 text-xs font-semibold text-white \".concat(item.existsOnChain===false||item.verified||item.verifiedOnChain||processingHash===item.ipfshash||!walletInfo.isRegistrar?\"cursor-not-allowed bg-slate-400\":\"bg-amber-600 hover:bg-amber-700\"),title:item.existsOnChain===false?\"Hash is missing on blockchain\":\"\",children:item.existsOnChain===false?\"Missing On-Chain\":processingHash===item.ipfshash?\"Approving...\":\"Approve\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>loadHistory(item.ipfshash),disabled:loadingHistoryHash===item.ipfshash,className:\"rounded-lg px-3 py-1.5 text-xs font-semibold text-white \".concat(loadingHistoryHash===item.ipfshash?\"cursor-not-allowed bg-slate-400\":\"bg-sky-600 hover:bg-sky-700\"),children:loadingHistoryHash===item.ipfshash?\"Loading...\":\"View History\"})]})})]}),historyByHash[item.ipfshash]&&/*#__PURE__*/_jsx(\"tr\",{children:/*#__PURE__*/_jsxs(\"td\",{colSpan:7,className:\"bg-slate-50 px-3 py-2\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-xs font-semibold text-slate-700\",children:\"Transfer History\"}),historyByHash[item.ipfshash].length===0?/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-slate-500\",children:\"No transfer records.\"}):/*#__PURE__*/_jsx(\"div\",{className:\"mt-1 space-y-1\",children:historyByHash[item.ipfshash].map((record,idx)=>/*#__PURE__*/_jsxs(\"p\",{className:\"break-all font-mono text-[11px] text-slate-600\",children:[record.from,\" -> \",record.to,\" at\",\" \",record.timestamp?new Date(record.timestamp*1000).toLocaleString():\"-\"]},\"\".concat(item.ipfshash,\"-\").concat(idx)))})]})})]},item._id))})]})})]})]})});}export default RegistrarDashboard;","map":{"version":3,"names":["React","useEffect","useState","Link","useNavigate","AdminPanel","approvePropertyOnChain","getPropertyHistoryOnChain","getPropertyOwnerOnChain","getWalletRoleOnChain","grantRegistrarOnChain","isWalletRegistrarOnChain","propertyExistsOnChain","revokeRegistrarOnChain","verifyPropertyOnChain","jsx","_jsx","jsxs","_jsxs","API_BASE","ZERO_ADDRESS","parseJsonSafe","response","contentType","headers","get","includes","text","Error","concat","slice","json","maskHash","hash","value","String","trim","length","maskValue","RegistrarDashboard","navigate","files","setFiles","loading","setLoading","actionMessage","setActionMessage","processingHash","setProcessingHash","walletInfo","setWalletInfo","wallet","adminAddress","isRegistrar","isAdmin","granting","setGranting","revoking","setRevoking","grantAddress","setGrantAddress","registrarUsers","setRegistrarUsers","loadingRegistrars","setLoadingRegistrars","historyByHash","setHistoryByHash","loadingHistoryHash","setLoadingHistoryHash","searchHash","setSearchHash","searchingOwner","setSearchingOwner","ownerDetails","setOwnerDetails","ownerSearchMessage","setOwnerSearchMessage","logout","localStorage","removeItem","replace","loadFiles","_data2","fetch","data","_unused","ok","_data","message","rows","Array","isArray","withStatus","Promise","all","map","item","existsOnChain","verifiedOnChain","currentOwnerWallet","transferHistoryCount","ipfshash","_unused2","_unused3","_unused4","history","filter","record","from","toLowerCase","to","_unused5","_objectSpread","Boolean","error","loadWalletRole","info","loadRegistrarUsers","registrars","walletAddress","isRegistrarOnChain","_unused6","approve","method","body","JSON","stringify","role","verifiedBy","prev","verified","verifiedAt","Date","toISOString","grantRegistrar","targetWalletAddress","nextAddress","revokeRegistrar","loadHistory","searchOwnerByHash","encodeURIComponent","copyHash","navigator","clipboard","writeText","_unused7","className","children","onClick","type","onChange","e","target","placeholder","disabled","name","aadhaar","Fragment","filename","userID","title","Number","href","rel","colSpan","idx","timestamp","toLocaleString","_id"],"sources":["C:/Users/ahmad/OneDrive/Desktop/evault/frontend/src/pages/RegistrarDashboard.js"],"sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport { Link } from \"react-router-dom\";\nimport { useNavigate } from \"react-router-dom\";\nimport AdminPanel from \"../components/AdminPanel.js\";\nimport {\n  approvePropertyOnChain,\n  getPropertyHistoryOnChain,\n  getPropertyOwnerOnChain,\n  getWalletRoleOnChain,\n  grantRegistrarOnChain,\n  isWalletRegistrarOnChain,\n  propertyExistsOnChain,\n  revokeRegistrarOnChain,\n  verifyPropertyOnChain,\n} from \"../contract/propertyActions.js\";\n\nconst API_BASE = \"http://localhost:5000\";\nconst ZERO_ADDRESS = \"0x0000000000000000000000000000000000000000\";\n\nasync function parseJsonSafe(response) {\n  const contentType = response.headers.get(\"content-type\") || \"\";\n  if (!contentType.includes(\"application/json\")) {\n    const text = await response.text();\n    throw new Error(\n      `API did not return JSON. Response started with: ${text.slice(0, 40)}`\n    );\n  }\n  return response.json();\n}\n\nfunction maskHash(hash) {\n  const value = String(hash || \"\").trim();\n  if (!value) return \"-\";\n  if (value.length <= 14) return value;\n  return `${value.slice(0, 8)}...${value.slice(-6)}`;\n}\n\nfunction maskValue(value) {\n  const text = String(value || \"\").trim();\n  if (!text) return \"-\";\n  if (text.length <= 10) return text;\n  return `${text.slice(0, 4)}...${text.slice(-4)}`;\n}\n\nfunction RegistrarDashboard() {\n  const navigate = useNavigate();\n  const [files, setFiles] = useState([]);\n  const [loading, setLoading] = useState(false);\n  const [actionMessage, setActionMessage] = useState(\"\");\n  const [processingHash, setProcessingHash] = useState(\"\");\n  const [walletInfo, setWalletInfo] = useState({\n    wallet: \"\",\n    adminAddress: \"\",\n    isRegistrar: false,\n    isAdmin: false,\n  });\n  const [granting, setGranting] = useState(false);\n  const [revoking, setRevoking] = useState(false);\n  const [grantAddress, setGrantAddress] = useState(\"\");\n  const [registrarUsers, setRegistrarUsers] = useState([]);\n  const [loadingRegistrars, setLoadingRegistrars] = useState(false);\n  const [historyByHash, setHistoryByHash] = useState({});\n  const [loadingHistoryHash, setLoadingHistoryHash] = useState(\"\");\n  const [searchHash, setSearchHash] = useState(\"\");\n  const [searchingOwner, setSearchingOwner] = useState(false);\n  const [ownerDetails, setOwnerDetails] = useState(null);\n  const [ownerSearchMessage, setOwnerSearchMessage] = useState(\"\");\n\n  const logout = () => {\n    localStorage.removeItem(\"user\");\n    localStorage.removeItem(\"role\");\n    navigate(\"/login\", { replace: true });\n  };\n\n  const loadFiles = async () => {\n    setLoading(true);\n    try {\n      let response = await fetch(`${API_BASE}/api/files?role=registrar`, {\n        headers: { \"x-role\": \"registrar\" },\n      });\n      let data;\n\n      try {\n        data = await parseJsonSafe(response);\n      } catch {\n        // Backward-compatible fallback to existing upload listing endpoint.\n        response = await fetch(`${API_BASE}/api/upload/all`);\n        data = await parseJsonSafe(response);\n      }\n\n      if (!response.ok) {\n        throw new Error(data?.message || \"Failed to fetch files\");\n      }\n\n      const rows = Array.isArray(data?.files) ? data.files : [];\n      const withStatus = await Promise.all(\n        rows.map(async (item) => {\n          let existsOnChain = null;\n          let verifiedOnChain = false;\n          let currentOwnerWallet = item.currentOwnerWallet || null;\n          let transferHistoryCount = null;\n\n          try {\n            existsOnChain = await propertyExistsOnChain(item.ipfshash);\n          } catch {\n            existsOnChain = null;\n          }\n\n          try {\n            verifiedOnChain = await verifyPropertyOnChain(item.ipfshash);\n          } catch {\n            verifiedOnChain = false;\n          }\n\n          try {\n            currentOwnerWallet = await getPropertyOwnerOnChain(item.ipfshash);\n          } catch {\n            // no-op\n          }\n\n          try {\n            const history = await getPropertyHistoryOnChain(item.ipfshash);\n            transferHistoryCount = Array.isArray(history)\n              ? history.filter((record) => {\n                  const from = String(record?.from || \"\").toLowerCase();\n                  const to = String(record?.to || \"\").toLowerCase();\n                  return from && to && from !== ZERO_ADDRESS && to !== ZERO_ADDRESS;\n                }).length\n              : 0;\n          } catch {\n            transferHistoryCount = null;\n          }\n\n          return {\n            ...item,\n            existsOnChain,\n            verifiedOnChain: Boolean(verifiedOnChain),\n            currentOwnerWallet,\n            transferHistoryCount,\n          };\n        })\n      );\n      setFiles(withStatus);\n    } catch (error) {\n      setActionMessage(\n        error?.message ||\n          \"Failed to load files. Ensure backend is running on http://localhost:5000.\"\n      );\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const loadWalletRole = async () => {\n    try {\n      const info = await getWalletRoleOnChain();\n      setWalletInfo(info);\n      setGrantAddress(info.wallet || \"\");\n      if (!info.isRegistrar) {\n        setActionMessage(\n          `Connected wallet ${info.wallet} is not registrar on-chain. Approval will fail until added by admin.`\n        );\n      }\n    } catch (error) {\n      setActionMessage(error?.message || \"Failed to read wallet role from blockchain.\");\n    }\n  };\n\n  const loadRegistrarUsers = async () => {\n    try {\n      setLoadingRegistrars(true);\n      const response = await fetch(`${API_BASE}/api/auth/registrars`);\n      const contentType = response.headers.get(\"content-type\") || \"\";\n      if (!contentType.includes(\"application/json\")) {\n        setRegistrarUsers([]);\n        setActionMessage(\n          \"Registrar management endpoint is unavailable (non-JSON response). Restart backend and try again.\"\n        );\n        return;\n      }\n      const data = await response.json();\n      if (!response.ok) {\n        throw new Error(data?.error || \"Failed to load registrar users\");\n      }\n\n      const rows = Array.isArray(data?.registrars) ? data.registrars : [];\n      const withStatus = await Promise.all(\n        rows.map(async (item) => {\n          const wallet = String(item.walletAddress || \"\").trim();\n          let isRegistrarOnChain = false;\n          if (wallet) {\n            try {\n              isRegistrarOnChain = await isWalletRegistrarOnChain(wallet);\n            } catch {\n              isRegistrarOnChain = false;\n            }\n          }\n          return { ...item, isRegistrarOnChain };\n        })\n      );\n      setRegistrarUsers(withStatus);\n    } catch (error) {\n      setActionMessage(error?.message || \"Failed to load registrar users.\");\n    } finally {\n      setLoadingRegistrars(false);\n    }\n  };\n\n  useEffect(() => {\n    loadWalletRole();\n    loadFiles();\n    loadRegistrarUsers();\n  }, []);\n\n  const approve = async (hash) => {\n    try {\n      setProcessingHash(hash);\n      setActionMessage(\"Approving property on blockchain...\");\n      await approvePropertyOnChain(hash);\n\n      await fetch(`${API_BASE}/api/files/verify`, {\n        method: \"PATCH\",\n        headers: { \"Content-Type\": \"application/json\", \"x-role\": \"registrar\" },\n        body: JSON.stringify({\n          hash,\n          role: \"registrar\",\n          verifiedBy: walletInfo.wallet || null,\n        }),\n      });\n\n      setActionMessage(\"Property approved successfully.\");\n      setFiles((prev) =>\n        prev.map((item) =>\n          item.ipfshash === hash\n            ? {\n                ...item,\n                existsOnChain: true,\n                verifiedOnChain: true,\n                verified: true,\n                verifiedAt: new Date().toISOString(),\n                verifiedBy: walletInfo.wallet || item.verifiedBy,\n              }\n            : item\n        )\n      );\n    } catch (error) {\n      const message = String(error?.message || \"\");\n      if (message.includes(\"Property not found\")) {\n        setActionMessage(\n          \"Property hash not registered on blockchain. Citizen must upload/register hash first.\"\n        );\n      } else {\n        setActionMessage(message || \"Approval failed\");\n      }\n    } finally {\n      setProcessingHash(\"\");\n    }\n  };\n\n  const grantRegistrar = async (targetWalletAddress) => {\n    try {\n      const nextAddress = String(targetWalletAddress || grantAddress || \"\").trim();\n      if (!nextAddress) {\n        setActionMessage(\"Enter a wallet address to grant registrar role.\");\n        return;\n      }\n      setGranting(true);\n      setActionMessage(\"Granting registrar role on-chain...\");\n      await grantRegistrarOnChain(nextAddress);\n      if (nextAddress.toLowerCase() === walletInfo.wallet.toLowerCase()) {\n        setWalletInfo((prev) => ({ ...prev, isRegistrar: true }));\n      }\n      await loadRegistrarUsers();\n      setActionMessage(`Registrar role granted to ${nextAddress}.`);\n    } catch (error) {\n      setActionMessage(error?.message || \"Failed to grant registrar role.\");\n    } finally {\n      setGranting(false);\n    }\n  };\n\n  const revokeRegistrar = async (targetWalletAddress) => {\n    try {\n      const nextAddress = String(targetWalletAddress || \"\").trim();\n      if (!nextAddress) {\n        setActionMessage(\"Enter a wallet address to revoke registrar role.\");\n        return;\n      }\n      if (nextAddress.toLowerCase() === String(walletInfo.adminAddress || \"\").toLowerCase()) {\n        setActionMessage(\"Admin registrar role cannot be revoked.\");\n        return;\n      }\n      setRevoking(true);\n      setActionMessage(\"Revoking registrar role on-chain...\");\n      await revokeRegistrarOnChain(nextAddress);\n      if (nextAddress.toLowerCase() === String(walletInfo.wallet || \"\").toLowerCase()) {\n        setWalletInfo((prev) => ({ ...prev, isRegistrar: false }));\n      }\n      await loadRegistrarUsers();\n      setActionMessage(`Registrar role revoked for ${nextAddress}.`);\n    } catch (error) {\n      setActionMessage(error?.message || \"Failed to revoke registrar role.\");\n    } finally {\n      setRevoking(false);\n    }\n  };\n\n  const loadHistory = async (hash) => {\n    try {\n      setLoadingHistoryHash(hash);\n      const history = await getPropertyHistoryOnChain(hash);\n      setHistoryByHash((prev) => ({ ...prev, [hash]: history }));\n    } catch (error) {\n      setActionMessage(error?.message || \"Failed to fetch property history\");\n    } finally {\n      setLoadingHistoryHash(\"\");\n    }\n  };\n\n  const searchOwnerByHash = async () => {\n    const value = String(searchHash || \"\").trim();\n    if (!value) {\n      setOwnerSearchMessage(\"Enter property hash first.\");\n      setOwnerDetails(null);\n      return;\n    }\n\n    try {\n      setSearchingOwner(true);\n      setOwnerSearchMessage(\"\");\n      setOwnerDetails(null);\n\n      const response = await fetch(\n        `${API_BASE}/api/property/${encodeURIComponent(value)}?role=registrar`,\n        { headers: { \"x-role\": \"registrar\" } }\n      );\n      const data = await parseJsonSafe(response);\n      if (!response.ok) {\n        throw new Error(data?.message || \"Failed to search property owner\");\n      }\n\n      setOwnerDetails(data);\n    } catch (error) {\n      setOwnerSearchMessage(error?.message || \"Failed to search owner by hash.\");\n    } finally {\n      setSearchingOwner(false);\n    }\n  };\n\n  const copyHash = async (hash) => {\n    const value = String(hash || \"\").trim();\n    if (!value) return;\n    try {\n      await navigator.clipboard.writeText(value);\n      setActionMessage(\"Property hash copied.\");\n    } catch {\n      setActionMessage(\"Copy failed. Please copy manually.\");\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-slate-100 via-slate-50 to-sky-100 p-4 md:p-6\">\n      <div className=\"mx-auto max-w-7xl space-y-6\">\n        <div className=\"rounded-2xl bg-white p-6 shadow-lg ring-1 ring-slate-200\">\n          <div className=\"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between\">\n            <div>\n              <h1 className=\"text-2xl font-bold tracking-tight text-slate-900\">Registrar Dashboard</h1>\n              <p className=\"text-sm text-slate-600\">Review, verify, and track property records.</p>\n            </div>\n            <div className=\"flex items-center gap-2\">\n              <Link\n                to=\"/user-lookup\"\n                className=\"rounded-xl bg-sky-600 px-4 py-2 text-sm font-semibold text-white shadow hover:bg-sky-700\"\n              >\n                User Lookup\n              </Link>\n              <Link\n                to=\"/explorer\"\n                className=\"rounded-xl bg-indigo-600 px-4 py-2 text-sm font-semibold text-white shadow hover:bg-indigo-700\"\n              >\n                Explorer\n              </Link>\n              <button\n                onClick={logout}\n                className=\"rounded-xl bg-rose-600 px-4 py-2 text-sm font-semibold text-white shadow hover:bg-rose-700\"\n              >\n                Logout\n              </button>\n            </div>\n          </div>\n        </div>\n\n        <div className=\"grid gap-6 lg:grid-cols-2\">\n\n\n          <div className=\"rounded-2xl bg-white p-6 shadow-lg ring-1 ring-slate-200\">\n            <h2 className=\"text-lg font-semibold text-slate-900\">Search By Property Hash</h2>\n            <div className=\"mt-3 flex flex-col gap-2 sm:flex-row\">\n              <input\n                type=\"text\"\n                value={searchHash}\n                onChange={(e) => setSearchHash(e.target.value)}\n                placeholder=\"Enter property hash\"\n                className=\"w-full rounded-xl border border-slate-300 px-3 py-2 text-xs outline-none focus:border-indigo-500\"\n              />\n              <button\n                onClick={searchOwnerByHash}\n                disabled={searchingOwner}\n                className={`rounded-xl px-4 py-2 text-xs font-semibold text-white ${\n                  searchingOwner ? \"cursor-not-allowed bg-slate-400\" : \"bg-indigo-600 hover:bg-indigo-700\"\n                }`}\n              >\n                {searchingOwner ? \"Searching...\" : \"Search\"}\n              </button>\n            </div>\n            {ownerSearchMessage && (\n              <p className=\"mt-3 rounded-lg border border-rose-200 bg-rose-50 px-3 py-2 text-xs text-rose-700\">\n                {ownerSearchMessage}\n              </p>\n            )}\n            {ownerDetails && (\n              <div className=\"mt-3 rounded-xl border border-slate-200 bg-slate-50 p-4\">\n                <p className=\"text-xs font-semibold uppercase tracking-wide text-slate-700\">Owner Details</p>\n                <p className=\"mt-2 break-all text-xs text-slate-700\">\n                  Wallet: <span className=\"font-mono\">{ownerDetails.walletAddress || \"-\"}</span>\n                </p>\n                <p className=\"mt-1 text-xs text-slate-700\">Name: {ownerDetails.name || \"-\"}</p>\n                <p className=\"mt-1 text-xs text-slate-700\">Role: {ownerDetails.role || \"-\"}</p>\n                <p className=\"mt-1 text-xs text-slate-700\">Aadhaar: {ownerDetails.aadhaar || \"-\"}</p>\n              </div>\n            )}\n          </div>\n        </div>\n\n        <div className=\"rounded-2xl bg-white p-6 shadow-lg ring-1 ring-slate-200\">\n          <h2 className=\"text-lg font-semibold text-slate-900\">Property Queue</h2>\n          <div className=\"mt-3 rounded-xl border border-indigo-200 bg-indigo-50 p-3 text-xs text-indigo-900\">\n            <p className=\"font-semibold\">Registrar Workflow</p>\n            <p className=\"mt-1\">\n              1) If status is <span className=\"font-semibold\">Missing On-Chain</span>, property hash is not\n              registered yet.\n            </p>\n            <p className=\"mt-1\">\n              2) Only after on-chain registration, registrar can approve verification.\n            </p>\n            <p className=\"mt-1\">\n              3) Use <span className=\"font-semibold\">View History</span> to review transfer ownership trail.\n            </p>\n          </div>\n          {actionMessage && (\n            <p className=\"mt-3 rounded-lg border border-sky-200 bg-sky-50 px-3 py-2 text-sm text-sky-800\">\n              {actionMessage}\n            </p>\n          )}\n          {loading ? (\n            <p className=\"mt-4 text-sm text-slate-500\">Loading documents...</p>\n          ) : files.length === 0 ? (\n            <p className=\"mt-4 text-sm text-slate-500\">No uploaded files found.</p>\n          ) : (\n            <div className=\"mt-4 overflow-x-auto rounded-xl border border-slate-200\">\n              <table className=\"min-w-full divide-y divide-slate-200\">\n                <thead>\n                  <tr className=\"bg-slate-50 text-left text-xs uppercase tracking-wide text-slate-600\">\n                    <th className=\"px-3 py-2\">File</th>\n                    <th className=\"px-3 py-2\">Owner ID</th>\n                    <th className=\"px-3 py-2\">Hash</th>\n                    <th className=\"px-3 py-2\">Current Owner</th>\n                    <th className=\"px-3 py-2\">Flow</th>\n                    <th className=\"px-3 py-2\">Status</th>\n                    <th className=\"px-3 py-2\">Action</th>\n                  </tr>\n                </thead>\n                <tbody className=\"divide-y divide-slate-100 bg-white\">\n                  {files.map((item) => (\n                    <React.Fragment key={item._id}>\n                    <tr className=\"hover:bg-slate-50\">\n                      <td className=\"px-3 py-2 text-sm text-slate-800\">{item.filename}</td>\n                      <td className=\"px-3 py-2\">\n                        <button\n                          type=\"button\"\n                          onClick={() => copyHash(item.userID)}\n                          title={item.userID}\n                          className=\"text-sm text-slate-700 underline decoration-dotted underline-offset-2 hover:text-indigo-700\"\n                        >\n                          {maskValue(item.userID)}\n                        </button>\n                      </td>\n                      <td className=\"px-3 py-2\">\n                        <button\n                          type=\"button\"\n                          onClick={() => copyHash(item.ipfshash)}\n                          title={item.ipfshash}\n                          className=\"font-mono text-xs text-slate-700 underline decoration-dotted underline-offset-2 hover:text-indigo-700\"\n                        >\n                          {maskHash(item.ipfshash)}\n                        </button>\n                      </td>\n                      <td className=\"px-3 py-2\">\n                        <button\n                          type=\"button\"\n                          onClick={() => copyHash(item.currentOwnerWallet)}\n                          title={item.currentOwnerWallet || \"-\"}\n                          className=\"font-mono text-xs text-slate-700 underline decoration-dotted underline-offset-2 hover:text-indigo-700\"\n                        >\n                          {maskValue(item.currentOwnerWallet)}\n                        </button>\n                      </td>\n                      <td className=\"px-3 py-2 text-xs text-slate-700\">\n                        {item.existsOnChain === false\n                          ? \"Registration Pending\"\n                          : Number(item.transferHistoryCount || 0) > 0\n                          ? \"Transferred Property\"\n                          : \"New Registration\"}\n                      </td>\n                      <td className=\"px-3 py-2 text-sm\">\n                        <span\n                          className={\n                            item.verified || item.verifiedOnChain\n                              ? \"text-emerald-700 font-medium\"\n                              : item.existsOnChain === false\n                              ? \"text-rose-700 font-medium\"\n                              : item.existsOnChain\n                              ? \"text-amber-700 font-medium\"\n                              : \"text-amber-700 font-medium\"\n                          }\n                        >\n                          {item.verified || item.verifiedOnChain\n                            ? \"Verified\"\n                            : item.existsOnChain === false\n                            ? \"Not Registered\"\n                            : \"Pending Approval\"}\n                        </span>\n                      </td>\n                      <td className=\"px-3 py-2\">\n                        <div className=\"flex flex-col gap-2\">\n                          <a\n                            href={`https://gateway.pinata.cloud/ipfs/${item.ipfshash}`}\n                            target=\"_blank\"\n                            rel=\"noreferrer\"\n                            className=\"rounded-lg bg-indigo-600 px-3 py-1.5 text-center text-xs font-semibold text-white hover:bg-indigo-700\"\n                          >\n                            View Document\n                          </a>\n                          <button\n                            onClick={() => approve(item.ipfshash)}\n                            disabled={\n                              item.existsOnChain === false ||\n                              item.verified ||\n                              item.verifiedOnChain ||\n                              processingHash === item.ipfshash ||\n                              !walletInfo.isRegistrar\n                            }\n                            className={`rounded-lg px-3 py-1.5 text-xs font-semibold text-white ${\n                              item.existsOnChain === false ||\n                              item.verified ||\n                              item.verifiedOnChain ||\n                              processingHash === item.ipfshash ||\n                              !walletInfo.isRegistrar\n                                ? \"cursor-not-allowed bg-slate-400\"\n                                : \"bg-amber-600 hover:bg-amber-700\"\n                            }`}\n                            title={item.existsOnChain === false ? \"Hash is missing on blockchain\" : \"\"}\n                          >\n                            {item.existsOnChain === false\n                              ? \"Missing On-Chain\"\n                              : processingHash === item.ipfshash\n                              ? \"Approving...\"\n                              : \"Approve\"}\n                          </button>\n                          <button\n                            onClick={() => loadHistory(item.ipfshash)}\n                            disabled={loadingHistoryHash === item.ipfshash}\n                            className={`rounded-lg px-3 py-1.5 text-xs font-semibold text-white ${\n                              loadingHistoryHash === item.ipfshash\n                                ? \"cursor-not-allowed bg-slate-400\"\n                                : \"bg-sky-600 hover:bg-sky-700\"\n                            }`}\n                          >\n                            {loadingHistoryHash === item.ipfshash ? \"Loading...\" : \"View History\"}\n                          </button>\n                        </div>\n                      </td>\n                    </tr>\n                    {historyByHash[item.ipfshash] && (\n                      <tr>\n                        <td colSpan={7} className=\"bg-slate-50 px-3 py-2\">\n                          <p className=\"text-xs font-semibold text-slate-700\">Transfer History</p>\n                          {historyByHash[item.ipfshash].length === 0 ? (\n                            <p className=\"text-xs text-slate-500\">No transfer records.</p>\n                          ) : (\n                            <div className=\"mt-1 space-y-1\">\n                              {historyByHash[item.ipfshash].map((record, idx) => (\n                                <p key={`${item.ipfshash}-${idx}`} className=\"break-all font-mono text-[11px] text-slate-600\">\n                                  {record.from} -> {record.to} at{\" \"}\n                                  {record.timestamp ? new Date(record.timestamp * 1000).toLocaleString() : \"-\"}\n                                </p>\n                              ))}\n                            </div>\n                          )}\n                        </td>\n                      </tr>\n                    )}\n                    </React.Fragment>\n                  ))}\n                </tbody>\n              </table>\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport default RegistrarDashboard;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}