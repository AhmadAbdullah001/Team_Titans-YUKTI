{"ast":null,"code":"import { ensureContractCode, ensureCorrectNetwork, ensureWalletConnected, getBrowserProvider, getReadOnlyContract, getWriteContract } from \"./eth.js\";\nasync function getWriteReadyContract() {\n  const provider = await getBrowserProvider();\n  await ensureWalletConnected(provider);\n  await ensureCorrectNetwork(provider);\n  await ensureContractCode(provider);\n  const signer = await provider.getSigner();\n  const contract = getWriteContract(signer);\n  const signerAddress = await signer.getAddress();\n  return {\n    contract,\n    signerAddress\n  };\n}\nasync function getReadReadyContract() {\n  const provider = await getBrowserProvider();\n  await ensureWalletConnected(provider);\n  await ensureCorrectNetwork(provider);\n  await ensureContractCode(provider);\n  return getReadOnlyContract(provider);\n}\nexport async function registerPropertyOnChain(hash) {\n  const {\n    contract\n  } = await getWriteReadyContract();\n  try {\n    const exists = await contract.verifyHash(hash);\n    if (exists) {\n      return \"already-registered\";\n    }\n  } catch {\n    // continue and try write path\n  }\n  try {\n    const tx = await contract.registerProperty(hash);\n    await tx.wait();\n    return tx.hash;\n  } catch (error) {\n    const message = String((error === null || error === void 0 ? void 0 : error.reason) || (error === null || error === void 0 ? void 0 : error.shortMessage) || (error === null || error === void 0 ? void 0 : error.message) || \"\");\n    if (message.toLowerCase().includes(\"already exists\")) {\n      return \"already-registered\";\n    }\n    if (message.includes(\"is not a function\") || message.includes(\"missing revert data\")) {\n      const tx = await contract.storeHash(hash);\n      await tx.wait();\n      return tx.hash;\n    }\n    throw error;\n  }\n}\nexport async function approvePropertyOnChain(hash) {\n  const {\n    contract,\n    signerAddress\n  } = await getWriteReadyContract();\n  const isRegistrar = await contract.registrars(signerAddress);\n  if (!isRegistrar) {\n    throw new Error(`Connected wallet ${signerAddress} is not on-chain registrar. Ask admin to call addRegistrar.`);\n  }\n  const tx = await contract.approveProperty(hash);\n  await tx.wait();\n  return tx.hash;\n}\nexport async function verifyPropertyOnChain(hash) {\n  const contract = await getReadReadyContract();\n  try {\n    return await contract.verifyProperty(hash);\n  } catch {\n    return await contract.verifyHash(hash);\n  }\n}\nexport async function getPropertyOwnerOnChain(hash) {\n  const contract = await getReadReadyContract();\n  try {\n    return await contract.getOwner(hash);\n  } catch {\n    return await contract.documentOwner(hash);\n  }\n}\nexport async function getWalletRoleOnChain() {\n  const {\n    contract,\n    signerAddress\n  } = await getWriteReadyContract();\n  const [isRegistrar, admin] = await Promise.all([contract.registrars(signerAddress), contract.admin()]);\n  return {\n    wallet: signerAddress,\n    isRegistrar: Boolean(isRegistrar),\n    isAdmin: String(admin).toLowerCase() === String(signerAddress).toLowerCase()\n  };\n}\nexport async function grantRegistrarOnChain(registrarAddress) {\n  const {\n    contract\n  } = await getWriteReadyContract();\n  const tx = await contract.addRegistrar(registrarAddress);\n  await tx.wait();\n  return tx.hash;\n}","map":{"version":3,"names":["ensureContractCode","ensureCorrectNetwork","ensureWalletConnected","getBrowserProvider","getReadOnlyContract","getWriteContract","getWriteReadyContract","provider","signer","getSigner","contract","signerAddress","getAddress","getReadReadyContract","registerPropertyOnChain","hash","exists","verifyHash","tx","registerProperty","wait","error","message","String","reason","shortMessage","toLowerCase","includes","storeHash","approvePropertyOnChain","isRegistrar","registrars","Error","approveProperty","verifyPropertyOnChain","verifyProperty","getPropertyOwnerOnChain","getOwner","documentOwner","getWalletRoleOnChain","admin","Promise","all","wallet","Boolean","isAdmin","grantRegistrarOnChain","registrarAddress","addRegistrar"],"sources":["C:/Users/ahmad/OneDrive/Desktop/evault/frontend/src/contract/propertyActions.js"],"sourcesContent":["import {\n  ensureContractCode,\n  ensureCorrectNetwork,\n  ensureWalletConnected,\n  getBrowserProvider,\n  getReadOnlyContract,\n  getWriteContract,\n} from \"./eth.js\";\n\nasync function getWriteReadyContract() {\n  const provider = await getBrowserProvider();\n  await ensureWalletConnected(provider);\n  await ensureCorrectNetwork(provider);\n  await ensureContractCode(provider);\n  const signer = await provider.getSigner();\n  const contract = getWriteContract(signer);\n  const signerAddress = await signer.getAddress();\n  return { contract, signerAddress };\n}\n\nasync function getReadReadyContract() {\n  const provider = await getBrowserProvider();\n  await ensureWalletConnected(provider);\n  await ensureCorrectNetwork(provider);\n  await ensureContractCode(provider);\n  return getReadOnlyContract(provider);\n}\n\nexport async function registerPropertyOnChain(hash) {\n  const { contract } = await getWriteReadyContract();\n\n  try {\n    const exists = await contract.verifyHash(hash);\n    if (exists) {\n      return \"already-registered\";\n    }\n  } catch {\n    // continue and try write path\n  }\n\n  try {\n    const tx = await contract.registerProperty(hash);\n    await tx.wait();\n    return tx.hash;\n  } catch (error) {\n    const message = String(error?.reason || error?.shortMessage || error?.message || \"\");\n    if (message.toLowerCase().includes(\"already exists\")) {\n      return \"already-registered\";\n    }\n    if (message.includes(\"is not a function\") || message.includes(\"missing revert data\")) {\n      const tx = await contract.storeHash(hash);\n      await tx.wait();\n      return tx.hash;\n    }\n    throw error;\n  }\n}\n\nexport async function approvePropertyOnChain(hash) {\n  const { contract, signerAddress } = await getWriteReadyContract();\n\n  const isRegistrar = await contract.registrars(signerAddress);\n  if (!isRegistrar) {\n    throw new Error(\n      `Connected wallet ${signerAddress} is not on-chain registrar. Ask admin to call addRegistrar.`\n    );\n  }\n\n  const tx = await contract.approveProperty(hash);\n  await tx.wait();\n  return tx.hash;\n}\n\nexport async function verifyPropertyOnChain(hash) {\n  const contract = await getReadReadyContract();\n  try {\n    return await contract.verifyProperty(hash);\n  } catch {\n    return await contract.verifyHash(hash);\n  }\n}\n\nexport async function getPropertyOwnerOnChain(hash) {\n  const contract = await getReadReadyContract();\n  try {\n    return await contract.getOwner(hash);\n  } catch {\n    return await contract.documentOwner(hash);\n  }\n}\n\nexport async function getWalletRoleOnChain() {\n  const { contract, signerAddress } = await getWriteReadyContract();\n  const [isRegistrar, admin] = await Promise.all([\n    contract.registrars(signerAddress),\n    contract.admin(),\n  ]);\n\n  return {\n    wallet: signerAddress,\n    isRegistrar: Boolean(isRegistrar),\n    isAdmin: String(admin).toLowerCase() === String(signerAddress).toLowerCase(),\n  };\n}\n\nexport async function grantRegistrarOnChain(registrarAddress) {\n  const { contract } = await getWriteReadyContract();\n  const tx = await contract.addRegistrar(registrarAddress);\n  await tx.wait();\n  return tx.hash;\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}