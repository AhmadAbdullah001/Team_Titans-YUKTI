{"ast":null,"code":"import { ensureContractCode, ensureCorrectNetwork, ensureWalletConnected, getBrowserProvider, getReadOnlyContract, getWriteContract } from \"./eth.js\";\nasync function getWriteReadyContract() {\n  const provider = await getBrowserProvider();\n  await ensureWalletConnected(provider);\n  await ensureCorrectNetwork(provider);\n  await ensureContractCode(provider);\n  const signer = await provider.getSigner();\n  return getWriteContract(signer);\n}\nasync function getReadReadyContract() {\n  const provider = await getBrowserProvider();\n  await ensureWalletConnected(provider);\n  await ensureCorrectNetwork(provider);\n  await ensureContractCode(provider);\n  return getReadOnlyContract(provider);\n}\nexport async function registerPropertyOnChain(hash) {\n  const contract = await getWriteReadyContract();\n  try {\n    const exists = await contract.verifyHash(hash);\n    if (exists) {\n      return \"already-registered\";\n    }\n  } catch {\n    // continue and try write path\n  }\n  try {\n    const tx = await contract.registerProperty(hash);\n    await tx.wait();\n    return tx.hash;\n  } catch (error) {\n    const message = String((error === null || error === void 0 ? void 0 : error.reason) || (error === null || error === void 0 ? void 0 : error.shortMessage) || (error === null || error === void 0 ? void 0 : error.message) || \"\");\n    if (message.toLowerCase().includes(\"already exists\")) {\n      return \"already-registered\";\n    }\n    if (message.includes(\"is not a function\") || message.includes(\"missing revert data\")) {\n      const tx = await contract.storeHash(hash);\n      await tx.wait();\n      return tx.hash;\n    }\n    throw error;\n  }\n}\nexport async function approvePropertyOnChain(hash) {\n  const contract = await getWriteReadyContract();\n  const tx = await contract.approveProperty(hash);\n  await tx.wait();\n  return tx.hash;\n}\nexport async function verifyPropertyOnChain(hash) {\n  const contract = await getReadReadyContract();\n  try {\n    return await contract.verifyProperty(hash);\n  } catch {\n    return await contract.verifyHash(hash);\n  }\n}\nexport async function getPropertyOwnerOnChain(hash) {\n  const contract = await getReadReadyContract();\n  try {\n    return await contract.getOwner(hash);\n  } catch {\n    return await contract.documentOwner(hash);\n  }\n}","map":{"version":3,"names":["ensureContractCode","ensureCorrectNetwork","ensureWalletConnected","getBrowserProvider","getReadOnlyContract","getWriteContract","getWriteReadyContract","provider","signer","getSigner","getReadReadyContract","registerPropertyOnChain","hash","contract","exists","verifyHash","tx","registerProperty","wait","error","message","String","reason","shortMessage","toLowerCase","includes","storeHash","approvePropertyOnChain","approveProperty","verifyPropertyOnChain","verifyProperty","getPropertyOwnerOnChain","getOwner","documentOwner"],"sources":["C:/Users/ahmad/OneDrive/Desktop/evault/frontend/src/contract/propertyActions.js"],"sourcesContent":["import {\n  ensureContractCode,\n  ensureCorrectNetwork,\n  ensureWalletConnected,\n  getBrowserProvider,\n  getReadOnlyContract,\n  getWriteContract,\n} from \"./eth.js\";\n\nasync function getWriteReadyContract() {\n  const provider = await getBrowserProvider();\n  await ensureWalletConnected(provider);\n  await ensureCorrectNetwork(provider);\n  await ensureContractCode(provider);\n  const signer = await provider.getSigner();\n  return getWriteContract(signer);\n}\n\nasync function getReadReadyContract() {\n  const provider = await getBrowserProvider();\n  await ensureWalletConnected(provider);\n  await ensureCorrectNetwork(provider);\n  await ensureContractCode(provider);\n  return getReadOnlyContract(provider);\n}\n\nexport async function registerPropertyOnChain(hash) {\n  const contract = await getWriteReadyContract();\n\n  try {\n    const exists = await contract.verifyHash(hash);\n    if (exists) {\n      return \"already-registered\";\n    }\n  } catch {\n    // continue and try write path\n  }\n\n  try {\n    const tx = await contract.registerProperty(hash);\n    await tx.wait();\n    return tx.hash;\n  } catch (error) {\n    const message = String(error?.reason || error?.shortMessage || error?.message || \"\");\n    if (message.toLowerCase().includes(\"already exists\")) {\n      return \"already-registered\";\n    }\n    if (message.includes(\"is not a function\") || message.includes(\"missing revert data\")) {\n      const tx = await contract.storeHash(hash);\n      await tx.wait();\n      return tx.hash;\n    }\n    throw error;\n  }\n}\n\nexport async function approvePropertyOnChain(hash) {\n  const contract = await getWriteReadyContract();\n  const tx = await contract.approveProperty(hash);\n  await tx.wait();\n  return tx.hash;\n}\n\nexport async function verifyPropertyOnChain(hash) {\n  const contract = await getReadReadyContract();\n  try {\n    return await contract.verifyProperty(hash);\n  } catch {\n    return await contract.verifyHash(hash);\n  }\n}\n\nexport async function getPropertyOwnerOnChain(hash) {\n  const contract = await getReadReadyContract();\n  try {\n    return await contract.getOwner(hash);\n  } catch {\n    return await contract.documentOwner(hash);\n  }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}