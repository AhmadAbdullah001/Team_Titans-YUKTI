{"ast":null,"code":"import{ensureContractCode,ensureCorrectNetwork,ensureWalletConnected,getBrowserProvider,getReadOnlyContract,getWriteContract}from\"./eth.js\";async function getWriteReadyContract(){const provider=await getBrowserProvider();await ensureWalletConnected(provider);await ensureCorrectNetwork(provider);await ensureContractCode(provider);const signer=await provider.getSigner();return getWriteContract(signer);}async function getReadReadyContract(){const provider=await getBrowserProvider();await ensureWalletConnected(provider);await ensureCorrectNetwork(provider);await ensureContractCode(provider);return getReadOnlyContract(provider);}export async function registerPropertyOnChain(hash){const contract=await getWriteReadyContract();try{const exists=await contract.verifyHash(hash);if(exists){return\"already-registered\";}}catch(_unused){// continue and try write path\n}try{const tx=await contract.registerProperty(hash);await tx.wait();return tx.hash;}catch(error){const message=String((error===null||error===void 0?void 0:error.reason)||(error===null||error===void 0?void 0:error.shortMessage)||(error===null||error===void 0?void 0:error.message)||\"\");if(message.toLowerCase().includes(\"already exists\")){return\"already-registered\";}if(message.includes(\"is not a function\")||message.includes(\"missing revert data\")){const tx=await contract.storeHash(hash);await tx.wait();return tx.hash;}throw error;}}export async function approvePropertyOnChain(hash){const contract=await getWriteReadyContract();const tx=await contract.approveProperty(hash);await tx.wait();return tx.hash;}export async function verifyPropertyOnChain(hash){const contract=await getReadReadyContract();try{return await contract.verifyProperty(hash);}catch(_unused2){return await contract.verifyHash(hash);}}export async function getPropertyOwnerOnChain(hash){const contract=await getReadReadyContract();try{return await contract.getOwner(hash);}catch(_unused3){return await contract.documentOwner(hash);}}","map":{"version":3,"names":["ensureContractCode","ensureCorrectNetwork","ensureWalletConnected","getBrowserProvider","getReadOnlyContract","getWriteContract","getWriteReadyContract","provider","signer","getSigner","getReadReadyContract","registerPropertyOnChain","hash","contract","exists","verifyHash","_unused","tx","registerProperty","wait","error","message","String","reason","shortMessage","toLowerCase","includes","storeHash","approvePropertyOnChain","approveProperty","verifyPropertyOnChain","verifyProperty","_unused2","getPropertyOwnerOnChain","getOwner","_unused3","documentOwner"],"sources":["C:/Users/ahmad/OneDrive/Desktop/evault/frontend/src/contract/propertyActions.js"],"sourcesContent":["import {\n  ensureContractCode,\n  ensureCorrectNetwork,\n  ensureWalletConnected,\n  getBrowserProvider,\n  getReadOnlyContract,\n  getWriteContract,\n} from \"./eth.js\";\n\nasync function getWriteReadyContract() {\n  const provider = await getBrowserProvider();\n  await ensureWalletConnected(provider);\n  await ensureCorrectNetwork(provider);\n  await ensureContractCode(provider);\n  const signer = await provider.getSigner();\n  return getWriteContract(signer);\n}\n\nasync function getReadReadyContract() {\n  const provider = await getBrowserProvider();\n  await ensureWalletConnected(provider);\n  await ensureCorrectNetwork(provider);\n  await ensureContractCode(provider);\n  return getReadOnlyContract(provider);\n}\n\nexport async function registerPropertyOnChain(hash) {\n  const contract = await getWriteReadyContract();\n\n  try {\n    const exists = await contract.verifyHash(hash);\n    if (exists) {\n      return \"already-registered\";\n    }\n  } catch {\n    // continue and try write path\n  }\n\n  try {\n    const tx = await contract.registerProperty(hash);\n    await tx.wait();\n    return tx.hash;\n  } catch (error) {\n    const message = String(error?.reason || error?.shortMessage || error?.message || \"\");\n    if (message.toLowerCase().includes(\"already exists\")) {\n      return \"already-registered\";\n    }\n    if (message.includes(\"is not a function\") || message.includes(\"missing revert data\")) {\n      const tx = await contract.storeHash(hash);\n      await tx.wait();\n      return tx.hash;\n    }\n    throw error;\n  }\n}\n\nexport async function approvePropertyOnChain(hash) {\n  const contract = await getWriteReadyContract();\n  const tx = await contract.approveProperty(hash);\n  await tx.wait();\n  return tx.hash;\n}\n\nexport async function verifyPropertyOnChain(hash) {\n  const contract = await getReadReadyContract();\n  try {\n    return await contract.verifyProperty(hash);\n  } catch {\n    return await contract.verifyHash(hash);\n  }\n}\n\nexport async function getPropertyOwnerOnChain(hash) {\n  const contract = await getReadReadyContract();\n  try {\n    return await contract.getOwner(hash);\n  } catch {\n    return await contract.documentOwner(hash);\n  }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}