{"ast":null,"code":"import { ethers } from \"ethers\";\nimport abi from \"./abi.json\";\nimport { HARDHAT_LOCALHOST_CHAIN_ID, contractAddress, LAND_REGISTRY_VERSION } from \"./contractconfig.js\";\nconst LOCAL_RPC_URL = \"http://127.0.0.1:8545\";\nlet isContractCodeValidated = false;\nexport function getLocalReadProvider() {\n  return new ethers.JsonRpcProvider(LOCAL_RPC_URL);\n}\nexport async function getBrowserProvider() {\n  if (!window.ethereum) {\n    throw new Error(\"MetaMask not installed\");\n  }\n  return new ethers.BrowserProvider(window.ethereum);\n}\nexport async function ensureWalletConnected(provider) {\n  const accounts = await provider.send(\"eth_accounts\", []);\n  if (accounts && accounts.length > 0) {\n    return accounts;\n  }\n  try {\n    return await provider.send(\"eth_requestAccounts\", []);\n  } catch (error) {\n    if ((error === null || error === void 0 ? void 0 : error.code) === -32002) {\n      throw new Error(\"MetaMask request already pending. Open MetaMask and approve first.\");\n    }\n    throw error;\n  }\n}\nexport async function ensureCorrectNetwork(provider) {\n  const network = await provider.getNetwork();\n  if (Number(network.chainId) === HARDHAT_LOCALHOST_CHAIN_ID) {\n    return;\n  }\n  const targetChainHex = `0x${HARDHAT_LOCALHOST_CHAIN_ID.toString(16)}`;\n  try {\n    await provider.send(\"wallet_switchEthereumChain\", [{\n      chainId: targetChainHex\n    }]);\n  } catch (error) {\n    if ((error === null || error === void 0 ? void 0 : error.code) === 4902) {\n      await provider.send(\"wallet_addEthereumChain\", [{\n        chainId: targetChainHex,\n        chainName: \"Hardhat Localhost\",\n        rpcUrls: [LOCAL_RPC_URL],\n        nativeCurrency: {\n          name: \"ETH\",\n          symbol: \"ETH\",\n          decimals: 18\n        }\n      }]);\n      return;\n    }\n    throw new Error(\"Wrong network in MetaMask. Switch to Hardhat Localhost (chainId 31337).\");\n  }\n}\nexport async function ensureContractCode(provider) {\n  if (!contractAddress || contractAddress === \"0x0000000000000000000000000000000000000000\") {\n    throw new Error(\"Contract address is not configured. Run blockchain deploy first.\");\n  }\n  if (isContractCodeValidated) {\n    return;\n  }\n  let code = \"0x\";\n  try {\n    code = await provider.getCode(contractAddress);\n  } catch (error) {\n    const rpcMessage = String((error === null || error === void 0 ? void 0 : error.message) || \"\");\n    const isRateLimit = (error === null || error === void 0 ? void 0 : error.code) === -32002 || rpcMessage.includes(\"too many errors\") || rpcMessage.includes(\"retrying in\");\n    if (!isRateLimit) {\n      throw error;\n    }\n\n    // Fallback to local Hardhat RPC when wallet RPC is throttled.\n    code = await getLocalReadProvider().getCode(contractAddress);\n  }\n  if (!code || code === \"0x\") {\n    throw new Error(`No contract found at ${contractAddress}. Redeploy and update config.`);\n  }\n  isContractCodeValidated = true;\n}\nexport function getReadOnlyContract(provider) {\n  return new ethers.Contract(contractAddress, abi, provider);\n}\nexport function getWriteContract(signer) {\n  return new ethers.Contract(contractAddress, abi, signer);\n}\nexport function getContractRuntimeConfig() {\n  return {\n    contractAddress,\n    chainId: HARDHAT_LOCALHOST_CHAIN_ID,\n    version: LAND_REGISTRY_VERSION || \"legacy\"\n  };\n}","map":{"version":3,"names":["ethers","abi","HARDHAT_LOCALHOST_CHAIN_ID","contractAddress","LAND_REGISTRY_VERSION","LOCAL_RPC_URL","isContractCodeValidated","getLocalReadProvider","JsonRpcProvider","getBrowserProvider","window","ethereum","Error","BrowserProvider","ensureWalletConnected","provider","accounts","send","length","error","code","ensureCorrectNetwork","network","getNetwork","Number","chainId","targetChainHex","toString","chainName","rpcUrls","nativeCurrency","name","symbol","decimals","ensureContractCode","getCode","rpcMessage","String","message","isRateLimit","includes","getReadOnlyContract","Contract","getWriteContract","signer","getContractRuntimeConfig","version"],"sources":["C:/Users/ahmad/OneDrive/Desktop/evault/frontend/src/contract/eth.js"],"sourcesContent":["import { ethers } from \"ethers\";\nimport abi from \"./abi.json\";\nimport {\n  HARDHAT_LOCALHOST_CHAIN_ID,\n  contractAddress,\n  LAND_REGISTRY_VERSION,\n} from \"./contractconfig.js\";\n\nconst LOCAL_RPC_URL = \"http://127.0.0.1:8545\";\nlet isContractCodeValidated = false;\n\nexport function getLocalReadProvider() {\n  return new ethers.JsonRpcProvider(LOCAL_RPC_URL);\n}\n\nexport async function getBrowserProvider() {\n  if (!window.ethereum) {\n    throw new Error(\"MetaMask not installed\");\n  }\n  return new ethers.BrowserProvider(window.ethereum);\n}\n\nexport async function ensureWalletConnected(provider) {\n  const accounts = await provider.send(\"eth_accounts\", []);\n  if (accounts && accounts.length > 0) {\n    return accounts;\n  }\n\n  try {\n    return await provider.send(\"eth_requestAccounts\", []);\n  } catch (error) {\n    if (error?.code === -32002) {\n      throw new Error(\n        \"MetaMask request already pending. Open MetaMask and approve first.\"\n      );\n    }\n    throw error;\n  }\n}\n\nexport async function ensureCorrectNetwork(provider) {\n  const network = await provider.getNetwork();\n  if (Number(network.chainId) === HARDHAT_LOCALHOST_CHAIN_ID) {\n    return;\n  }\n\n  const targetChainHex = `0x${HARDHAT_LOCALHOST_CHAIN_ID.toString(16)}`;\n  try {\n    await provider.send(\"wallet_switchEthereumChain\", [{ chainId: targetChainHex }]);\n  } catch (error) {\n    if (error?.code === 4902) {\n      await provider.send(\"wallet_addEthereumChain\", [\n        {\n          chainId: targetChainHex,\n          chainName: \"Hardhat Localhost\",\n          rpcUrls: [LOCAL_RPC_URL],\n          nativeCurrency: { name: \"ETH\", symbol: \"ETH\", decimals: 18 },\n        },\n      ]);\n      return;\n    }\n    throw new Error(\n      \"Wrong network in MetaMask. Switch to Hardhat Localhost (chainId 31337).\"\n    );\n  }\n}\n\nexport async function ensureContractCode(provider) {\n  if (\n    !contractAddress ||\n    contractAddress === \"0x0000000000000000000000000000000000000000\"\n  ) {\n    throw new Error(\n      \"Contract address is not configured. Run blockchain deploy first.\"\n    );\n  }\n\n  if (isContractCodeValidated) {\n    return;\n  }\n\n  let code = \"0x\";\n  try {\n    code = await provider.getCode(contractAddress);\n  } catch (error) {\n    const rpcMessage = String(error?.message || \"\");\n    const isRateLimit =\n      error?.code === -32002 ||\n      rpcMessage.includes(\"too many errors\") ||\n      rpcMessage.includes(\"retrying in\");\n\n    if (!isRateLimit) {\n      throw error;\n    }\n\n    // Fallback to local Hardhat RPC when wallet RPC is throttled.\n    code = await getLocalReadProvider().getCode(contractAddress);\n  }\n\n  if (!code || code === \"0x\") {\n    throw new Error(\n      `No contract found at ${contractAddress}. Redeploy and update config.`\n    );\n  }\n\n  isContractCodeValidated = true;\n}\n\nexport function getReadOnlyContract(provider) {\n  return new ethers.Contract(contractAddress, abi, provider);\n}\n\nexport function getWriteContract(signer) {\n  return new ethers.Contract(contractAddress, abi, signer);\n}\n\nexport function getContractRuntimeConfig() {\n  return {\n    contractAddress,\n    chainId: HARDHAT_LOCALHOST_CHAIN_ID,\n    version: LAND_REGISTRY_VERSION || \"legacy\",\n  };\n}\n"],"mappings":"AAAA,SAASA,MAAM,QAAQ,QAAQ;AAC/B,OAAOC,GAAG,MAAM,YAAY;AAC5B,SACEC,0BAA0B,EAC1BC,eAAe,EACfC,qBAAqB,QAChB,qBAAqB;AAE5B,MAAMC,aAAa,GAAG,uBAAuB;AAC7C,IAAIC,uBAAuB,GAAG,KAAK;AAEnC,OAAO,SAASC,oBAAoBA,CAAA,EAAG;EACrC,OAAO,IAAIP,MAAM,CAACQ,eAAe,CAACH,aAAa,CAAC;AAClD;AAEA,OAAO,eAAeI,kBAAkBA,CAAA,EAAG;EACzC,IAAI,CAACC,MAAM,CAACC,QAAQ,EAAE;IACpB,MAAM,IAAIC,KAAK,CAAC,wBAAwB,CAAC;EAC3C;EACA,OAAO,IAAIZ,MAAM,CAACa,eAAe,CAACH,MAAM,CAACC,QAAQ,CAAC;AACpD;AAEA,OAAO,eAAeG,qBAAqBA,CAACC,QAAQ,EAAE;EACpD,MAAMC,QAAQ,GAAG,MAAMD,QAAQ,CAACE,IAAI,CAAC,cAAc,EAAE,EAAE,CAAC;EACxD,IAAID,QAAQ,IAAIA,QAAQ,CAACE,MAAM,GAAG,CAAC,EAAE;IACnC,OAAOF,QAAQ;EACjB;EAEA,IAAI;IACF,OAAO,MAAMD,QAAQ,CAACE,IAAI,CAAC,qBAAqB,EAAE,EAAE,CAAC;EACvD,CAAC,CAAC,OAAOE,KAAK,EAAE;IACd,IAAI,CAAAA,KAAK,aAALA,KAAK,uBAALA,KAAK,CAAEC,IAAI,MAAK,CAAC,KAAK,EAAE;MAC1B,MAAM,IAAIR,KAAK,CACb,oEACF,CAAC;IACH;IACA,MAAMO,KAAK;EACb;AACF;AAEA,OAAO,eAAeE,oBAAoBA,CAACN,QAAQ,EAAE;EACnD,MAAMO,OAAO,GAAG,MAAMP,QAAQ,CAACQ,UAAU,CAAC,CAAC;EAC3C,IAAIC,MAAM,CAACF,OAAO,CAACG,OAAO,CAAC,KAAKvB,0BAA0B,EAAE;IAC1D;EACF;EAEA,MAAMwB,cAAc,GAAG,KAAKxB,0BAA0B,CAACyB,QAAQ,CAAC,EAAE,CAAC,EAAE;EACrE,IAAI;IACF,MAAMZ,QAAQ,CAACE,IAAI,CAAC,4BAA4B,EAAE,CAAC;MAAEQ,OAAO,EAAEC;IAAe,CAAC,CAAC,CAAC;EAClF,CAAC,CAAC,OAAOP,KAAK,EAAE;IACd,IAAI,CAAAA,KAAK,aAALA,KAAK,uBAALA,KAAK,CAAEC,IAAI,MAAK,IAAI,EAAE;MACxB,MAAML,QAAQ,CAACE,IAAI,CAAC,yBAAyB,EAAE,CAC7C;QACEQ,OAAO,EAAEC,cAAc;QACvBE,SAAS,EAAE,mBAAmB;QAC9BC,OAAO,EAAE,CAACxB,aAAa,CAAC;QACxByB,cAAc,EAAE;UAAEC,IAAI,EAAE,KAAK;UAAEC,MAAM,EAAE,KAAK;UAAEC,QAAQ,EAAE;QAAG;MAC7D,CAAC,CACF,CAAC;MACF;IACF;IACA,MAAM,IAAIrB,KAAK,CACb,yEACF,CAAC;EACH;AACF;AAEA,OAAO,eAAesB,kBAAkBA,CAACnB,QAAQ,EAAE;EACjD,IACE,CAACZ,eAAe,IAChBA,eAAe,KAAK,4CAA4C,EAChE;IACA,MAAM,IAAIS,KAAK,CACb,kEACF,CAAC;EACH;EAEA,IAAIN,uBAAuB,EAAE;IAC3B;EACF;EAEA,IAAIc,IAAI,GAAG,IAAI;EACf,IAAI;IACFA,IAAI,GAAG,MAAML,QAAQ,CAACoB,OAAO,CAAChC,eAAe,CAAC;EAChD,CAAC,CAAC,OAAOgB,KAAK,EAAE;IACd,MAAMiB,UAAU,GAAGC,MAAM,CAAC,CAAAlB,KAAK,aAALA,KAAK,uBAALA,KAAK,CAAEmB,OAAO,KAAI,EAAE,CAAC;IAC/C,MAAMC,WAAW,GACf,CAAApB,KAAK,aAALA,KAAK,uBAALA,KAAK,CAAEC,IAAI,MAAK,CAAC,KAAK,IACtBgB,UAAU,CAACI,QAAQ,CAAC,iBAAiB,CAAC,IACtCJ,UAAU,CAACI,QAAQ,CAAC,aAAa,CAAC;IAEpC,IAAI,CAACD,WAAW,EAAE;MAChB,MAAMpB,KAAK;IACb;;IAEA;IACAC,IAAI,GAAG,MAAMb,oBAAoB,CAAC,CAAC,CAAC4B,OAAO,CAAChC,eAAe,CAAC;EAC9D;EAEA,IAAI,CAACiB,IAAI,IAAIA,IAAI,KAAK,IAAI,EAAE;IAC1B,MAAM,IAAIR,KAAK,CACb,wBAAwBT,eAAe,+BACzC,CAAC;EACH;EAEAG,uBAAuB,GAAG,IAAI;AAChC;AAEA,OAAO,SAASmC,mBAAmBA,CAAC1B,QAAQ,EAAE;EAC5C,OAAO,IAAIf,MAAM,CAAC0C,QAAQ,CAACvC,eAAe,EAAEF,GAAG,EAAEc,QAAQ,CAAC;AAC5D;AAEA,OAAO,SAAS4B,gBAAgBA,CAACC,MAAM,EAAE;EACvC,OAAO,IAAI5C,MAAM,CAAC0C,QAAQ,CAACvC,eAAe,EAAEF,GAAG,EAAE2C,MAAM,CAAC;AAC1D;AAEA,OAAO,SAASC,wBAAwBA,CAAA,EAAG;EACzC,OAAO;IACL1C,eAAe;IACfsB,OAAO,EAAEvB,0BAA0B;IACnC4C,OAAO,EAAE1C,qBAAqB,IAAI;EACpC,CAAC;AACH","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}